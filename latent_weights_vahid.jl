using DataFrames, Statistics, GLMakie , ColorSchemes
GLMakie.activate!()
theme = theme_minimal()
theme.palette = (; color = ColorSchemes.tab20)
# theme.palette = (; color = [:firebrick,:steelblue])
theme.fontsize = 20
set_theme!(theme)

## copied output from haoming
arr = [
    Float32[
        0.13633783  -0.4206249   -0.01087815
       -0.08012556  -0.16081473  -0.00139621
        0.00712797   0.16360521   0.15027231
        0.05308922   0.47408867   0.05094212
       -0.04018222  -0.22659585   0.13629897
        0.18765791   0.50923705  -0.10553086
       -0.34966424  -0.30745345  -0.19614066
        0.02597373  -0.13002092   0.13218813
        0.12183509  -0.06091610  -0.06542284
       -0.05278348   0.26831207   0.15644914
       -0.18384057  -0.21969099  -0.08287070
        0.15534623   0.73293483   0.29285866
       -0.12076710  -0.23930226  -0.38477269
        0.31064203   0.09562223   0.10668824
       -0.03841598  -0.06335407  -0.23468062
       -0.23551506  -0.04112066   0.44790924
       -0.33967668  -0.33071208  -0.30345720
        0.00054924   0.14379612  -0.42608199
       -0.02538965   0.2853109    0.19902551
        0.05882227   0.47151074  -0.02604080
        0.13518322   0.13044363   0.18949452
       -0.20404452  -0.28690562  -0.00645324
       -0.08760851   0.49571493   0.18811799
        0.01498097  -0.37743941   0.30624592
       -0.11777966  -0.26044384   0.01216841
        0.26081422  -0.08488440   0.10526892
       -0.19088146   0.03707206  -0.15419079
       -0.23883823   0.13221064  -0.04363716
        0.05037922  -0.10769515   0.02420688
       -0.19706000   0.26258925  -0.17630394
       -0.18773246  -0.05632079  -0.05662148
       -0.10564189   0.32603559  -0.24670613
        0.20309454  -0.01004118  -0.00813760
       -0.12325515  -0.06085545  -0.09129106
       -0.08351522   0.02932484   0.18207613
        0.01200454   0.01157741  -0.18847461
       -0.09469726  -0.17119077  -0.51076394
       -0.09432617   0.04412963   0.07036716
       -0.19436534  -0.46903327   0.12515622
       -0.19876753   0.02178831  -0.01269425
       -0.10568409   0.34655523  -0.22535795
       -0.15890777   0.15030363   0.10577814
    ],
    Float32[
       -0.21166655  -0.24456114  -0.01560651
        0.20320647  -0.19991188   0.12144678
        0.10078280  -0.11335214  -0.07353607
       -0.08359580   0.10815990  -0.07464676
       -0.14800413  -0.21127979  -0.33536240
        0.22612460   0.27517405   0.03145299
       -0.06736048  -0.28094080  -0.03005306
        0.19873649  -0.19000328   0.07621867
        0.07086221  -0.11964916  -0.06373410
        0.19921835  -0.08146788  -0.03192432
       -0.25473884  -0.15263148  -0.28743839
        0.27543885   0.26107737   0.00029042
       -0.14250757  -0.26910415   0.06436313
        0.06221741  -0.06937096   0.13872223
        0.06886952  -0.07435589  -0.01966484
        0.18872590  -0.11139709  -0.07433663
       -0.13672997  -0.20625588  -0.29514304
        0.21828808   0.24868962   0.00976283
       -0.02301600  -0.30536082   0.01172370
        0.02168367  -0.07489651   0.15133163
        0.08798533  -0.09176742  -0.03284546
        0.19179821  -0.07161214  -0.05953982
       -0.23877570  -0.16315338  -0.23184703
        0.25713128   0.28309181  -0.03281085
       -0.12549086  -0.28687280   0.03560530
       -0.06395660  -0.04254624   0.25091234
        0.09690644  -0.09630173  -0.05042772
        0.27422309  -0.10655231  -0.15710589
       -0.30734709  -0.12338935  -0.21221386
        0.16114397   0.29297292   0.05287946
       -0.19150737  -0.28414914   0.11813722
        0.04777595  -0.07625107   0.28620046
        0.08899316  -0.09374250  -0.03300053
        0.11379250  -0.12462597  -0.04387467
       -0.25281930  -0.11978607  -0.30534804
        0.31368280   0.28927019  -0.02032424
       -0.20680346  -0.23592921   0.04649420
        0.19738115  -0.18817914   0.07937358
        0.06887128  -0.09193488  -0.02806197
        0.23912570  -0.06573234  -0.11246231
       -0.25003305  -0.19427469  -0.23336130
        0.26470369   0.28794163  -0.03411683
    ],
    Float32[
        0.10846949  -0.26820025   0.21127602
        0.27868830   0.45063272   0.44768810
       -0.26648070  -0.25967540  -0.21237837
       -0.18991841  -0.13383676  -0.37832287
       -0.28686401   0.20003662  -0.05189781
        0.05706725  -0.38141072  -0.20348941
        0.16025898  -0.14520045   0.22606890
        0.29483730   0.42457113   0.45073170
       -0.27047622  -0.29072013  -0.20198041
       -0.08914229   0.19397071  -0.32317810
       -0.31627706   0.05477460  -0.12432455
        0.08603965  -0.34092388  -0.18136430
        0.13458234  -0.23803762   0.14622734
        0.20901670   0.24040848   0.36468968
       -0.27718110  -0.31282076  -0.27013397
       -0.06395887   0.23106638  -0.27171445
       -0.29454220   0.17227120  -0.09787992
        0.08582138  -0.34245370  -0.18225406
        0.21037677  -0.13156260   0.18546200
        0.21091035   0.23065686   0.35300820
       -0.26559490  -0.28943800  -0.20625612
       -0.07061906   0.18289746  -0.28618410
       -0.29572678   0.06148241  -0.14102800
        0.05819388  -0.33034056  -0.19508868
        0.12908076  -0.19101222   0.15604892
        0.19917944   0.08613615   0.26994760
       -0.25541500  -0.30558082  -0.24171655
       -0.05876388   0.28669247  -0.23661369
       -0.37047923  -0.01898397  -0.19578601
        0.06653320  -0.47198707  -0.22179131
        0.13539316  -0.28467050   0.12607439
        0.25309995   0.18649833   0.29598236
       -0.26981470  -0.31520367  -0.23949127
       -0.11581143   0.14247021  -0.31154105
       -0.33443633   0.04546234  -0.11806167
        0.07452051  -0.32961515  -0.18227588
        0.11532269  -0.30503514   0.13193667
        0.27689514   0.40614447   0.43964374
       -0.24309416  -0.31457165  -0.23734352
       -0.05877537   0.25305954  -0.26503060
       -0.31508842   0.06521115  -0.14921450
        0.08107285  -0.35646070  -0.18299490
    ]
]
# Step 1: reshape each matrix from (42,3) → (6,7,3)
reshaped = [reshape(A, 6, 7, 3) for A in arr]

# Step 2: stack them along a new 4th dimension → size (6,7,3,3)
stacked = cat(reshaped...; dims=4)

# Step 3: permute to order (3,3,6,7)
final = permutedims(stacked, (3, 4, 1, 2))

##
moth1 = abs.(mean(final,dims=4)[:,:,:])
low = moth1[1,:,:]
shared = moth1[2,:,:]
high = moth1[3,:,:]

F = Figure() 
ax = Axis(F[1,1],xticks = ([1,2,3,4,5,6],["fx","fy","fz","tx","ty","tz"]),yticks=[1,2,3],title="Mean Projection Weights Shared Latents ",
ylabel = "Latent",xlabel="f/t axis")
h = heatmap!(ax,high')
Colorbar(F[1,2],h)
F